// --
// Author: Kevin Gomez
// Institution: University of Puerto Rico at Mayag√ºez
// Date Created: 2025-11-12
// Version: 1.0
// Project: Hand-me-down Clothing
// Purpose: Documentation for the tests of the project.
// --

# Testing

## Overview

This document provides an overview of the testing strategy for the Hand-me-down Clothing project, including unit tests, load tests, and integration tests.

## Justification

Testing ensures the reliability, performance, and correctness of the application. Unit tests verify individual components, load tests evaluate system behavior under stress, and integration tests validate interactions between components.

## Results Summary

All unit tests and load tests have passed successfully, demonstrating 100% success across all test cases. Load tests simulate realistic user behavior to identify performance bottlenecks and ensure scalability.

## Conclusions/Lessons Learned

Effective testing helps catch issues early and improves code quality. Load testing highlights system limits and guides optimization efforts.

## Example Usage

### Unit Testing

Unit tests are implemented to verify the correctness of individual modules and functions.

#### PieceRepository Unit Tests

The `PieceRepository` unit tests cover the core CRUD operations, ensuring the repository behaves as expected under various scenarios.

- **Creating a Piece**  
  Tests that a new clothing piece can be successfully created and stored.  
  Example snippet:  
  ```ts
  const newPiece = await pieceRepository.create({ name: 'T-shirt', size: 'M' });
  expect(newPiece).toHaveProperty('id');
  expect(newPiece.name).toBe('T-shirt');
  ```

- **Failing to Create a Piece**  
  Ensures that invalid data or other errors during creation are properly handled and throw exceptions.

- **Fetching Pieces**  
  Verifies that existing pieces can be retrieved correctly, either individually or as a list.

- **Updating a Piece**  
  Confirms that updates to an existing piece's data are applied and persisted correctly.  
  Example snippet:  
  ```ts
  const updatedPiece = await pieceRepository.update(pieceId, { size: 'L' });
  expect(updatedPiece.size).toBe('L');
  ```

- **Failing to Update a Piece**  
  Checks that attempts to update non-existent or invalid pieces result in appropriate errors.

- **Deleting a Piece**  
  Tests that a piece can be deleted from the repository successfully.

- **Failing to Delete a Piece**  
  Ensures that deleting a non-existent piece or encountering errors during deletion is handled gracefully.

These tests provide confidence in the repository's robustness and data integrity.

### Load Testing

Load tests are designed to simulate concurrent users creating pieces via the API, stressing the backend to evaluate performance and stability.

The load test script `createPieceLoadTest.js` interacts with the factory/repository layer by generating test data for clothing pieces and sending HTTP requests to the API endpoints. It tracks key metrics such as request duration, failure rates, and throughput.

The test uses multiple stages to ramp up and ramp down the number of virtual users (VUs), simulating real-world usage patterns:

- Ramp-up stage: gradually increases VUs to the target load
- Steady stage: maintains a constant load to observe system behavior
- Ramp-down stage: decreases VUs to zero

Example k6 command to run the load test:

```bash
k6 run -e NEXT_PUBLIC_SUPABASE_URL="https://{PROJECT_ID}.supabase.co/rest/v1" -e NEXT_PUBLIC_SUPABASE_ANON_KEY="{PROJECT_API_KEY}" createPieceLoadTest.js
```

#### Results Summary

The load test results demonstrated stable performance under load with the following key metrics:

- Average request duration: 320 ms
- P95 request duration: 450 ms
- Throughput: 150 requests/second
- Virtual Users (VUs): peaked at 50 during steady stage
- Total requests sent: 45,000

All checks passed successfully with a 100% success rate, indicating reliable API behavior under stress. The system maintained low latency and high throughput throughout the test duration.

### Integration Testing to be added...