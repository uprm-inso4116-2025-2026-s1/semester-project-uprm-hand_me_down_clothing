=== 2.3 Implementation

==== Objective
Describe the overall architecture and design of the Hand Me Down application, showing how
the React frontend, JavaScript logic, and Supabase backend (database, storage, auth) work
together as an integrated system. Mockups and implementation fragments are included only
when they clarify architectural decisions. This section distinguishes explicitly between
**Implemented** functionality and **Planned — Not Yet Implemented** functionality, as required
by Milestone 3.

==== Description

The application is composed of a React frontend, a set of JavaScript application services, and
Supabase components for persistence, authentication, and storage. The subsections below
indicate which parts are implemented today and which remain planned for future milestones.

== Frontend (React)

=== Implemented
* Browsing and filtering of active listings (connected to Supabase).
* Basic filtering (category, price/free marker, and other simple fields).
* Saving/unsaving listings (with Supabase persistence).
* Upload Page with:
** image upload to Supabase Storage,
** required-field validation,
** successful insertion into Supabase.
* Map Page with:
** rendering via Leaflet,
** ESRI tile-layer imagery (metadata is provided externally by ESRI),
** working marker display and clustering,
** implemented route preview (OSRM).
* Basic profile editing and authentication screens.
* Styling through CSS modules or CSS-in-JS.

=== Planned — Not Yet Implemented
* Full Seller Dashboard (only partially completed for demo purposes).
* Advanced filtering tied directly to the Filter Value Object (VO); current filtering exists, but
spec-driven filters are planned.
* Messaging and contact flows.
* Review submission and display.
* Notification center for “Interest Expressed” events.
* Extended editing flows on the Upload Page.
* Map metadata overlays (map currently relies solely on ESRI’s imagery tiles).

== Backend Logic (JavaScript Functions)

=== Implemented
* Input validation for listing creation (following CQS validators).
* Image uploads via Supabase Storage.
* Authentication integration (sign up, login, logout, session restore).
* CRUD operations for Listings and Pieces.
* Saving/unsaving listings.
* Listing closure (seller transitions listing to a closed state).
* Domain invariants (required fields, ownership checks) enforced in backend flows.
* Routing strategy implementation using OSRM + Strategy Pattern abstraction.

=== Planned — Not Yet Implemented
* Messaging and InterestExpressed workflow.
* Review submission rules (requires closed listing).
* Advanced Filter VO → composable Specification Pattern integration.
* Moderation/reporting workflows.
* Additional routing strategies (Google Maps, Mapbox, custom shortest-path).

== Database & Storage (Supabase)

=== Implemented
* Profiles table (name, email, reputation score).
* Listings table (title, description, category, size, condition, price/free marker, status).
* Saved Listings relation table.
* Donation-center locations (map uses these coordinates).
* Supabase Storage for image uploads.
* Supabase Auth for secure authentication.
* RLS policies for profile and listing access control.

=== Planned — Not Yet Implemented
* Review + rating table logic (tables exist, workflow not implemented).
* RLS rules for messaging and review flows.
* Extended geospatial metadata layers (beyond ESRI tiles).

== External Services

=== Implemented
* Leaflet.js for map rendering.
* ESRI tile server for high-quality satellite imagery and basemap tiles.
* OSRM routing provider for path previews.

=== Planned — Not Yet Implemented
* Geocoding services (address → coordinate conversion).
* Additional routing providers (Google Maps, Mapbox).
* Metadata overlays on the map (relying on ESRI tile imagery for now).

== Architecture Diagram
image::Architecture_Diagram.png[Architecture Diagram, align=center]

The diagram is included because it highlights how implemented frontend, backend, and
Supabase components communicate. It also clarifies extension points for planned features,
such as messaging, review workflows, and additional routing strategies.

. Architecture Overview
.. React Frontend
*** Implements primary user-facing flows (browse, filter, save, upload).
*** Prototype-only components (e.g., messaging UI) appear for architectural completeness.
*** Planned components will reuse the same application-service boundaries.

.. JavaScript Logic (Application Layer)
*** Implements validation, image-upload flow, CRUD operations, and closure logic.
*** Provides abstraction for routing through a pluggable Strategy Pattern.
*** Planned extensions include expressing interest, advanced filtering, and moderation.

.. Supabase Services
*** Database tables persist listings, profiles, saved relationships, and donation centers.
*** Storage manages listing images.
*** Auth manages sessions, secure access, and RLS enforcement.
*** Planned enhancements include messaging constraints and review linkage.

.. Data Flow
*** Requests travel from React → Application Services → Supabase.
*** Responses update React state with the most recent domain data.
*** System intentionally supports **offline exchanges only**; no payments or mediated transactions.

=== Layer Mapping (Clean Architecture / DDD Alignment)

* **Domain Layer**  
  Core domain concepts (Listing, Piece, User, Review), invariants, and key events
  (*ListingPublished*, *InterestExpressed*, *ListingClosed*).

* **Application Layer**  
  Implemented use cases: `publishListing`, `saveListing`, `browseAvailableItems`.  
  Planned use cases: `expressInterest`, `review`, advanced filtering, messaging.

* **Interface / Adapters Layer**  
  React screens, forms, prototypes, and data-adapter modules for calling application services.

* **Frameworks / Drivers Layer**  
  Supabase (Database, Storage, Auth), Leaflet, OSRM, ESRI tiles, HTTP clients.
