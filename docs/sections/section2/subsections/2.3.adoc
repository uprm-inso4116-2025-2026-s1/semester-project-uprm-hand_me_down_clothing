=== 2.3 Implementation

==== Objective
Describe the overall architecture and design of the clothing repurposing application, showing
how the React frontend, JavaScript logic, and Supabase database/storage/auth components
work together. Include mockups and selected fragments that clarify implementation decisions.
This chapter distinguishes between what has already been implemented and what remains part
of the planned architecture.

==== Description
The application is structured as follows.  
Where relevant, we clarify which parts are already implemented in the current system versus
planned extensions that have architectural support but no functional code yet.

* Frontend (React)
** The implemented portions of the frontend handle the user interface for browsing active listings,
saving favorites, uploading new listings, and loading donation centers. These components are fully connected to Supabase and reflect real data.
** Some UI pages are **planned but not yet implemented**; these exist only as prototypes
and their purpose here is to show intended architectural integration, not to behave as a user manual.
** Planned pages/screens include:
*** Home Page: shows recent listings and navigation options. *(Prototype implemented; data binding functional.)*
*** Clothing Listing Page: displays a scrollable list of available items with filters and sorting. *(Core listing feed implemented; extended filters planned.)*
*** Upload Page: supports publishing items as listings. *(Partially implemented: image upload + required-field validation completed; extended editing flows planned.)*
*** Saved Listings Page: lets buyers revisit bookmarked items. *(Basic saving implemented; full saved-list dashboard planned.)*
*** Map Page: integrates with Leaflet to display donation centers. *(Basic map rendering implemented; advanced metadata display planned.)*
** Styling is implemented with CSS modules or CSS-in-JS for maintainability.

* Backend Logic (JavaScript functions)
** The backend logic includes a mixture of implemented modules and planned modules.  
Implemented logic includes:
*** Input validation for listing creation.
*** Image uploads to Supabase Storage.
*** Authentication integration via Supabase Auth.
*** Basic CRUD operations on listings and user profiles.
*** Enforcement of invariants such as required fields and mandatory seller identity.
** Planned logic includes:
*** Messaging and contact flows linked to the `InterestExpressed` event.
*** Review submission rules (requiring a closed listing before review).
*** Advanced filtering through a `Filter` value object tied to domain requirements.
*** Moderation and reporting workflows.

* Database & Storage (Supabase)
** The database schema contains several **fully implemented** structures:
*** User profiles (name, email, role, reputation score).
*** Listings (seller ID, title, description, category, size, condition, price/free marker, status).
*** Saved listings associations.
*** Donation center metadata used by the Map page.
** Reviews and ratings tables exist in the schema but **full review logic is planned**, not yet implemented.
** Supabase Storage manages image uploads and retrieval in production.
** Supabase Auth is fully functional for authentication and secure access.

* External Services
** Leaflet.js provides the implemented base map functionality for donation center locations.
** Optional geocoding APIs are part of the **planned** extension for address-to-coordinate conversion.

==== Architecture Diagram
The architecture of the application is designed to separate concerns between the frontend, backend logic, and Supabase services. This diagram is included because it clarifies how implemented and planned components fit into the systemâ€™s layered design and how data moves between layers.

image::Architecture_Diagram.png[Architecture Diagram, align=center]

. Architecture Overview
.. React Frontend
*** Implements the primary user-facing mechanisms for browsing, filtering, and saving listings.
*** User actions such as creating a listing or saving an item trigger calls to implemented backend functions.
*** Planned UI components (e.g., messaging, enhanced search tools) will integrate with the same flow.

.. JavaScript Logic (Backend Logic)
*** Implements input validation, storage coordination, and basic CRUD operations.
*** Formats data before insertion into the database and handles error responses.
*** Planned logic will extend this layer to handle events such as expressing interest, review submission, and improved filtering.

.. Supabase Services
*** Implemented database tables store active listings, profiles, saved relationships, and donation centers.
*** Cloud Storage handles implemented image-upload flows.
*** Auth enforces authentication and authorization, ensuring proper access control.
*** Planned enhancements include RLS-based constraints for messaging and review linking.

.. Data Flow
*** Requests flow from the React frontend through JavaScript logic to Supabase.
*** Responses update React state so users see the most recent data.
*** The platform **does not** process payments or facilitate mediated transactions; offline coordination is intentional and domain-driven.
*** Separating UI, logic, and persistence ensures maintainability and future extensibility.

==== Layer Mapping (Clean Architecture / DDD Alignment)
* **Domain Layer**: Core concepts (Listing, Piece, User, Review), invariants (required fields, category assignment), and event definitions.  
* **Application Layer**: Implemented use cases (publishListing, saveListing), and planned use cases (expressInterest, closeListing, review).  
* **Interface/Adapters Layer**: React components for forms, lists, profile, and prototype messaging UIs; adapters for calling application services.  
* **Frameworks/Drivers Layer**: Supabase services (PostgreSQL, Storage, Auth), Leaflet maps, geocoding APIs, and HTTP clients.

