=== *2.1.6 - Function Signatures*

==== Objective
Define domain-level function signatures that describe how actions are carried out, including inputs,
outputs, and possible changes in the domain.

==== Description
[removed]#Function signatures are formal specifications of functions or actions that define:#

[.added]#Function signatures specify how actors in the system interact through domain actions. They define the logical relationships between inputs, outputs, and resulting state changes:# 

- *The name of the function*: The action being performed.  
- *The input parameters*: The information required by the action.  
- *Output*: Type of data the function produces.  
- *State changes*: How the action affects the domain.

The general format of a function signature is:

- FunctionName: Input1 >< Input2 >< ... -> OutputType#
- [.added]#**Description** – what the function does.#
- [.added]#**Preconditions** – what must be true or available for the function to execute.#
- [.added]#**Postconditions** - what becomes true afterwards.#
- [.added]#**Notes** - clarifications about scope, limits, or non-covered cases.#



[.removed]#This expresses the action's name, its input parameters with their types, the output type it produces,
and any state changes in the domain.#

[.removed]#Function signatures do not describe how the function is implemented. Instead, they focus on the
relationship between inputs, outputs, and possible state changes.#

==== Examples

publishListing : Piece >< Seller >< Locale -> [.changed]#Either[ValidationError,ListingPublished]#

[.added]#Description::# [.added]#A Seller publishes a Piece in a given Locale, producing a ListingPublished event.#

[.added]#Preconditions::# [.added]#Seller and Piece exist and are active; Piece has required metadata (title, condition, images).#

[.added]#Postconditions::# [.added]#Listing becomes visible; `ListingPublished` recorded.#

[.added]#Notes::# [.added]#Discovery-only; no in-platform payments.#


expressInterest : Listing >< Buyer -> [.changed]#Either[ContactError, InterestExpressed]#

[.added]#Description::# [.added]#A Buyer signals interest in a Listing to start contact with the Seller.#

[.added]#Preconditions::# [.added]#Listing is open; Buyer is authenticated.#

[.added]#Postconditions::# [.added]#`InterestExpressed` links Buyer and Seller.#

[.added]#Notes::# [.added]#Returns `ContactError` if listing is closed/unavailable.#

[.removed]#A Buyer expresses interest in a specific Listing, producing an InterestExpressed event that signals contact between Buyer and Seller.#

rate : Piece >< ConditionRating -> [.changed]#Option[ConditionRating]#

[.added]#Description::# [.added]#Assigns or updates a Piece’s condition rating.#

[.added]#Preconditions::# [.added]#Piece exists; rating within 1–5.#

[.added]#Postconditions::# [.added]#Piece’s stored rating updated.#

[.added]#Notes::# [.added]#Returns `None` if Piece missing/inactive.#

[.removed]#A Piece receives a ConditionRating, producing or updating the ConditionRating attribute.#

review : Seller >< Buyer >< Review -> [.changed]#Either[ReviewError, ReviewSubmitted]#  

[.added]#Description::# [.added]#Records a review after an offline exchange.#

[.added]#Preconditions::# [.added]#A prior interaction/closed listing exists between the parties.#


[.added]#Postconditions::# [.added]#`ReviewSubmitted` attached to reviewer/reviewee.#
[.added]#Notes::# [.added]#Returns `ReviewError` if no eligible exchange is found.#


[.removed]#A review is submitted by a Buyer or Seller after an offline exchange, creating a ReviewSubmitted event associated with the interaction.#

closeListing : Listing >< Seller -> [.changed]#Either[ClosedError, ListingClosed]#  

[.added]#Description::# [.added]#Seller closes an active Listing after exchange or withdrawal.#

[.added]#Preconditions::# [.added]#Seller owns the Listing; Listing is active.#

[.added]#Postconditions::# [.added]#Listing state becomes "closed"; 'ListingClosed' recorded.#

[.added]#Notes::# [.added]#Not callable by Buyers.#

[.removed]#A Seller closes a Listing after the offline exchange or withdrawal, producing a ListingClosed event and removing the item from visibility.#

categorize : Piece >< Type -> [.changed]#Option[Piece]#

[.added]#Description::# [.added]#Assigns a category type to a Piece.#

[.added]#Preconditions::# [.added]#Piece exists; Type is valid.#

[.added]#Postconditions::# [.added]#Piece’s Type attribute updated.#

[.added]#Notes::# [.added]#Returns `None` if Piece missing/inactive. Does not change visibility.#

[.removed]#A Piece is assigned a Type, returning the updated Piece.#

discard : Piece -> [.changed]#Option[Void]#

[.added]#Description::# [.added]#Removes a Piece from active circulation.#

[.added]#Preconditions::# [.added]#Piece exists and is active.#

[.added]#Postconditions::# [.added]#Piece marked as discarded/inactive.#

[.added]#Notes::# [.added]#Returns `None` if Piece missing/inactive.#

[.removed]#Removes a Piece from active circulation, marking it as no longer available.#

[.added]
==== Example Scenario: From Listing to Offline Exchange
[.added]
--
1. Seller publishes a listing using `publishListing(Piece, Seller, Locale)` → produces `ListingPublished`.  
2. Buyer browses available items and finds one of interest.  
3. Buyer [.changed]#triggers `expressInterest(Listing, Buyer)` → produces `InterestExpressed`.#  
4. Both users coordinate offline to exchange the item.  
5. Seller closes the listing via `closeListing(Listing, Seller)` → produces `ListingClosed`.  
6. Buyer leaves a review using `review(Seller, Buyer, Review)` → produces `ReviewSubmitted`.
--